## Безопасный маршрут («Цифровой прорыв», 2023) 
### Кейс от РЖД
**Команда:**  "Деревяшки"

### Описание задачи
При движении моторвагонного подвижного состава имеют место случаи выхода на маршрут следования людей, попадания 
посторонних предметов на железнодорожные пути или выезд автотранспорта. В таких ситуациях без преувеличения 
важна каждая секунда, и, если локомотивная бригада не принимает оперативных мер по причине отвлечения от 
контроля маршрута следования, может произойти трагедия. 

### Задача участников
Создать систему контроля за состоянием пути, наличия посторонних лиц, предметов на железнодорожном полотне, 
препятствующих свободному следованию подвижного состава, приближающихся транспортных средств. Система должна 
анализировать видеопоток постоянно и при выявлении людей или посторонних предметов иметь возможность послать 
сигнал на устройство световой и звуковой индикации.

### Решение
Решение: 
1. Преобработка видео (OpenCV)
2. Выделение интересующих зон на видео для поиска объектов 
3. Детекция объектов в выделенной зоне (YOLO v8)
4. Постобработка ситуаций определение событий (группировка детекций) 

![demo](media/demo.gif)
- Поиск объектов при помощи YOLO8 в определенных областях видеопотока
- Разметка областей в видеоряде
- Детекция объектов в размеченных областях

**Модуль по работе с моделью:** [model.py](model.py)  
**Ноутбук с решением:** [baseline_rzhd_yolo8.ipynb](baseline_rzhd_yolo8.ipynb)

Используемые библиотеки:
- ultralytics
- opencv-python
- pandas
- numpy

### Установка
`pip install ultralytics`  
`pip install opencv-python`      
`pip install pandas`  
`pip install numpy` 

### Входные данные
- Видео поток с камер подвижного состава (фронтальная/левая/правая камеры)

### Пример использования 
    model = YOLO('yolov8n.pt')

    detector = ModelDetected(model=model, type_cam='front', skip_frames=10, conf_level=0.7, verbose=False, dict_classes={0: 'person', 2: 'car'}, device='cuda')

    detector.load_video("input_file.mp4")
    detector.detected()
    detector.calc_events(time_by_events=7)

    # ссылка на сгенерированное видео
    print(detector.output_file)
    # отчет найденных событий в формате pd.DataFrame
    print(detector.history_df)
